<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
<title>Blank Page - Brand</title>
<link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
<link rel="stylesheet" href="./fonts/fontawesome-all.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
	type="text/javascript"></script>


<style>
#success_message {
	display: none;
}

* {
	box-sizing: border-box;
	font-size: 16px;
}

.container {
	width: 900px;
	margin: 0 auto;
}

.container h1 {
	margin: 20px;
	text-align: center;
}

.container form {
	padding: 20px;
	background: #EBF0F4;
	border-radius: 10px;
}

.form-group {
	border: 1px solid white;
	box-shadow: 2px 2px 4px 0 rgba(0, 0, 0, 0.2);
	border-radius: 20px;
	display: block;
	align-items: center;
	padding: 0 0 100px 30px;
	margin-bottom: 20px;
	height: 60px;
}

.help-block.error {
	margin-bottom: 5px;
}

.messages {
	margin: 10px 5px;
	color: #dc3545
}

label {
	width: auto;
	white-space: nowrap;
}

div.text {
	/* border: 1px solid black; */
	display: inline-block;
	width: 80px;
	margin-left: 50px;
}

.form-control {
	display: inline-block;
	position: relative;
	margin-right: 30px;
	min-width: 500px !important;
	max-width: 500px !important;
	width: 500px;
}

.help-block {
	font-size: 12px;
	display: block;
	position: relative;
	margin-top: 2px;
	color: red;
	width: 300px;
}

.well {
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	width: 700px;
}

.change_password {
	display: inline-block;
	position: relative;
	color: blue;
	text-decoration: underline;
	cursor: pointer;
}

#owner_password {
	cursor: not-allowed;
	background-color: #eaecf4;
}

#hotel_lic_id {
	cursor: not-allowed;
	background-color: #eaecf4;
}
.hotelLicPic_btn {
	border: none;
	border-radius: 5px;
	width:50px;
	height:40px;
	background: goldenrod;
	color: #FFF;
	background-color:#f1ecd1
}

.update_btn, .save_btn{
	border: none;
	border-radius: 5px;
	width:60px;
	height:40px;
	background: goldenrod;
	color: #574f36;
	background-color:#f1ecd1;
	margin:10px;

}

.save_btn{
display: none;
}

button:hover {
	background: #f8c544;
	color: #333;;
	cursor: pointer;
}
button:active {
  background-color: #e69609;
}

.change_password{
	font-size:20px;
	cursor:url('./img/graycat.png');
	
}


</style>
</head>

<body id="page-top">
	<div id="wrapper">
		<nav
				class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0"
				style="background: #f1ecd1;">
			<div class="container-fluid d-flex flex-column p-0">
				<a
						class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0"
						href="#">
					<div class="sidebar-brand-text mx-3">
						<img width="59" height="33"
							 src="../f_hotel_17/assets17/img/avatars/logo-only.png">
					</div>
				</a>
				<hr class="sidebar-divider my-0">
				<ul class="navbar-nav">
					<li class="nav-item dropdown show"><a
							class="dropdown-toggle nav-link" aria-expanded="true"
							data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
							style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">帳號管理</a>
						<div class="dropdown-menu show" data-bs-popper="none"
							 style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
							<a class="dropdown-item" href="../owner/OwnerAccount.html"
							   style="padding: 2px 30px; font-size: 13px;">基本資料</a>
							<div class="dropdown-divider"
								 style="border-color: rgb(255, 255, 255);"></div>
						</div>
					</li>
					<li class="nav-item dropdown show"><a
							class="dropdown-toggle nav-link" aria-expanded="true"
							data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
							style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">房間管理</a>
						<div class="dropdown-menu show" data-bs-popper="none"
							 style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
							<a class="dropdown-item" href="../f_hotel_17/roomType.html"
							   style="padding: 2px 30px; font-size: 13px;">房型資訊</a><a
								class="dropdown-item" href="../f_hotel_17/room.html"
								style="padding: 2px 30px; font-size: 13px;">房間資訊</a>
						</div>
					</li>
					<li class="nav-item dropdown show"><a
							class="dropdown-toggle nav-link" aria-expanded="true"
							data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
							style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">訂單管理</a>
						<div class="dropdown-menu show" data-bs-popper="none"
							 style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
							<a class="dropdown-item" href="../f_27/hotel-orders.html"
							   style="padding: 2px 30px; font-size: 13px;">訂單管理</a>
							<div class="dropdown-divider"
								 style="border-color: rgb(255, 255, 255);"></div>
						</div>
					</li>
				</ul>
				<div class="text-center d-none d-md-inline">
					<button class="btn rounded-circle border-0" id="sidebarToggle"
							type="button"></button>
				</div>
			</div>
		</nav>


		<div class="d-flex flex-column" id="content-wrapper">
			<div id="content">
				<nav
					class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
					<div class="container-fluid">
						<button class="btn btn-link d-md-none rounded-circle me-3"
							id="sidebarToggleTop" type="button">
							<i class="fas fa-bars"></i>
						</button>
						<ul class="navbar-nav flex-nowrap ms-auto">
							<li class="nav-item dropdown no-arrow">
								<div class="nav-item dropdown no-arrow">
									<a class="dropdown-toggle nav-link" aria-expanded="false"
										data-bs-toggle="dropdown" href="#"><span
										class="d-none d-lg-inline me-2 text-gray-600 small">Valerie
											Luna</span><img class="border rounded-circle img-profile"
										src="./img/avatars/avatar1.jpeg"></a>
									<div
										class="dropdown-menu shadow dropdown-menu-end animated--grow-in"
										style="min-width: 110px;">
										<a class="dropdown-item" href="#"><i
											class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Logout</a>
									</div>
								</div>
							</li>
						</ul>
					</div>
				</nav>

				<div class="container">

					<form class="well form-horizontal" action=" " method="post"
						id="contact_form">
						<fieldset>

							<!-- Form Name -->
							<legend>基本資料管理</legend>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">姓名</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">
										<input name="owner_name" id="owner_name" class="form-control"
											type="text" maxlength="50">
									</div>
								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">身分證</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">
										<input name="owner_id" id="owner_id" class="form-control"
											type="text" maxlength="10">
									</div>
								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">電子信箱</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">
										<input name="owner_email" id="owner_email"
											class="form-control" type="text" maxlength="50">
									</div>
								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">密碼</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">

										<p class="change_password">變更密碼?<img src="./img/graycat.gif" style="width:50px;height: 50px;"></img></p>
									</div>
								</div>
							</div>


							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">手機/市話</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">
										<input name="owner_phone" id="owner_phone"
											class="form-control" type="text" maxlength="10">
									</div>
								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">銀行帳號</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">
										<input name="owner_bank" id="owner_bank" class="form-control"
											type="text" maxlength="14">
									</div>
								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">寵物旅館名稱</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">
										<input name="hotel_name" id="hotel_name" class="form-control"
											type="text" maxlength="20">
									</div>
								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-1 control-label">旅館地址</label>
								<div class="col-md-4 inputGroupContainer">
									<div class="input-group">
										<input name="hotel_address" id="hotel_address"
											class="form-control" type="text" maxlength="100">
									</div>
								</div>
							</div>

							
							<div class="hotel_lic_pic">
								<label class="col-md-1 control-label">許可證</label>
								<button class="hotelLicPic_btn">📑</button>
							</div>
							<div>
								<span>證號:</span> <span id="hotel_lic"></span>
						</fieldset>
						<div class>
							<button class="update_btn">編輯</button>
							<button class="save_btn">保存</button>
						</div>
					</form>
				</div>
			</div>
			<!-- /.container -->

			<footer class="bg-white sticky-footer">
				<div class="container my-auto">
					<div class="text-center my-auto copyright">
						<span>Copyright © Brand 2023</span>
					</div>
				</div>
			</footer>
		</div>
		<a class="border rounded d-inline scroll-to-top" href="#page-top"><i
			class="fas fa-angle-up"></i></a>
	</div>

</body>

<script src="Jquery/jquery3.6.4.min.js"></script>
<script src="./js/theme.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.4.5/js/bootstrapvalidator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="../assets/js/owner_login.js"></script>
<script>
    $(function () {
		const hotelId = getOwnerId();
   
    //====================================查詢使用者資料============================================//
    	$.ajax({
    		  url: `/ownerAccount/${hotelId}`,
    		  type: 'GET',
    		  contentType: "application/json",
    		  success: function(res) {
    		    console.log(res);
    		    
    		    $("#owner_name").val(res.ownerName);
    		    $("#owner_id").val(res.ownerId);
    		    $("#owner_email").val(res.ownerEmail);
    		    $("#owner_password").val(res.ownerPassword);
    		    $("#owner_phone").val(res.ownerPhone);
    		    $("#owner_bank").val(res.ownerBank);
    		    $("#hotel_name").val(res.hotelName);
    		    $("#hotel_address").val(res.hotelAddress);
    		    $("#hotel_address").val(res.hotelAddress);
    		    var hotelLicId = res.hotelLicId;
    		    console.log(hotelLicId);
    		    $('#hotel_lic').text($('#hotel_lic').text()+hotelLicId);
    		    
    		    const hotelLicPic = res.hotelLicPic;

    		    $('.hotel_lic_pic').on("click",function(){
    		    	Swal.fire({
    		    		title:"許可證",
    		    		width:"600px",
    		    		html:`<img src="data:image/octet-stream;base64,${hotelLicPic}" style="width:500px">`
    		    	});
    		    });
    		    
    		  },
    		  error: function(xhr, status, error) {
    		   
    		  }
    		});
    	//====================================查詢使用者資料============================================//    	

    
    
        // 讓輸入框變為不可修改
        $('.form-control').prop('disabled', true);
        
        
      //====================================修改個資============================================//
        
        //修改用function , 因為有兩個部分都會用到
        function updateOwnerAccount(data) {
			const hotelId = getOwnerId();
            $.ajax({
                url: `/ownerAccount/${hotelId}`,
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (res) {
                    console.log("更新成功");
                },
                error: function (err) {
                    console.log("更新失敗");
                }
            });
        }
        
        // 編輯
        $(".update_btn").on("click",function(){
            $(".form-control").prop("disabled",false);
            $(".save_btn").css("display","inline-block");
        });
	
        //儲存
        $(".save_btn").on("click",function(){
        	Swal.fire({
        		title:"是否儲存資料?",
        		html:`<img src= "./img/update.gif" style="with 300px; height:300px;">`,
        		showCancelButton: true,
        	    confirmButtonText: "確定",
        	    cancelButtonText: "取消",		
        	})
        	.then(result => {
        		if (result.isConfirmed) {	
            $('.form-control').prop('disabled',true);
        		
            //名字驗證
            var newOwnerName = $("#owner_name").val();           
      	  	var nameRegex = /^[\u4E00-\u9FFFㄅ-ㄩㄚ-ㄦA-Za-z\s]{2,50}$/; 	  
      	  	if (!nameRegex.test(newOwnerName)) {
      	    	Swal.fire({
      	      		allowOutsideClick: false,
      	      		icon: 'error',
      	      		title: '業主名稱格式有誤',
      	    	});
      	    	$('.form-control').prop('disabled',false);
      	    	return; //只要驗證不通過就阻止後續程式執行,不然資料就進後端了
      	  	}
            
            
            //信箱驗證
           	var newOwnerEmail = $("#owner_email").val();
           	var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        	if (!emailRegex.test(newOwnerEmail)) {
        	  Swal.fire({
        	    allowOutsideClick: false,
        	    icon: 'error',
        	    title: '信箱格式有誤',
        	  });
        	  $('.form-control').prop('disabled',false);
        	  return;
        	}
            //電話驗證      
           	var newOwnerPhone = $("#owner_phone").val();
           	var phoneRegex = /^(0[1-9][0-9]{8}|(02|03[2-9]|04[1-9]|05[2-9]|06[2-9]|07[2-9]|08[2-9]|09[1-8]|037|049|082|089|0826|0829|0836|0839|0896|0899)\d{6,8})$/;
        	if (!phoneRegex.test(newOwnerPhone)) {
        	    Swal.fire({
        	      allowOutsideClick: false,
        	      icon: 'error',
        	      title: '手機/市話格式有誤',
        	    });
        	    $('.form-control').prop('disabled',false);
        	    return; //只要驗證不通過就阻止後續程式執行,不然資料就進後端了
        	  }
        	//收款帳戶驗證
           	var newOwnerBank = $("#owner_bank").val();
           	var bankRegex = /^\d{8,}$/;
        	if (!bankRegex.test(newOwnerBank)) {
        	    Swal.fire({
        	      allowOutsideClick: false,
        	      icon: 'error',
        	      title: '收款帳戶格式有誤',
        	    });
        	    $('.form-control').prop('disabled',false);
        	    return; //只要驗證不通過就阻止後續程式執行,不然資料就進後端了
        	  }
        	
            //驗證旅館名稱    	
            var newHotelName = $("#hotel_name").val();
            var hotelNameRegex = /^.{1,}$/;
            if (!hotelNameRegex.test(newHotelName)) {
              // 驗證不通過，執行相應的處理邏輯
              Swal.fire({
                allowOutsideClick: false,
                icon: 'error',
                title: '寵物旅館名稱格式有誤',
              });
              $('.form-control').prop('disabled',false);
              return;
            }
            
            
            var newHotelAddress = $("#hotel_address").val();
            var addressRegex = /^[\u4E00-\u9FFF0-9\u3105-\u3129\-]+$/;
        	if (!addressRegex.test(newHotelAddress)) {
        	    Swal.fire({
        	      allowOutsideClick: false,
        	      icon: 'error',
        	      title: '旅館地址格式有誤',
        	    });
        	    $('.form-control').prop('disabled',false);
        	    return; //只要驗證不通過就阻止後續程式執行,不然資料就進後端了
        		}
        	  
            var data = {
                    ownerName: newOwnerName,
                    ownerEmail: newOwnerEmail,
                    ownerPhone: newOwnerPhone,
                    ownerBank: newOwnerBank,
                    hotelName: newHotelName,
                    hotelAddress: newHotelAddress,
                    hotelLicId: $("#hotel_lic").text(),
                    ownerPassword: $("#owner_password").val(),
                    
                    
                	};         
            		updateOwnerAccount(data);
        	 	}else{
        	 		return;
        	 	}
        		Swal.fire({
        			html:`<img src= "./img/dancingCat.gif" style="with 300px; height:300px;">`,
        			title:"資料已更新",
        			confirmButtonText: "確定"
        			
        		})
        		$(".save_btn").css("display","none");
        		
            }); 
        });
            
            
       
    
        $('#contact_form').bootstrapValidator({


            fields: {
                owner_name: {
                    validators: {
                        stringLength: {
                            min: 2,
                            message: '請填入姓氏與姓名至少二字元'
                        },
                        notEmpty: {
                            message: '請填入名字'
                        },
                        regexp: {
                            regexp: /^[\u4E00-\u9FFFㄅ-ㄩㄚ-ㄦA-Za-z\s]+$/,
                            message: '此欄位不得有符號及數字或使用空格區隔'
                        },
                    }
                },

                owner_id: {
                    validators: {
                        notEmpty: {
                            message: '請填入身分證字號'
                        },
                        stringLength: {
                            min: 10,
                            message: '長度不符'
                        },
                        regexp: {
                            regexp: /^[A-Z]{1}[1-2]{1}\d{8}$/,
                            message: '身分證格式不正確'
                        }
                    }
                },
                owner_email: {
                    validators: {
                        notEmpty: {
                            message: '請填入信箱'
                        },
                        emailAddress: {
                            message: '請輸入有效的信箱'
                        }
                    }
                },
                owner_phone: {
                    validators: {
                        notEmpty: {
                            message: '請填入連絡電話'
                        },
                        regexp: {
                            regexp: /^\d{8,10}$/,
                            message: '長度不符'
                        },
                    }
                },
                owner_bank: {
                	validators: {
                        stringLength: {
                            min: 8,
                            message: '收款帳戶長度不符'
                        },
                        notEmpty: {
                            message: '此欄位不得空白'
                        },
                        regexp: {
                            regexp: /^\d+$/,
                            message: '銀行帳號格式異常'
                        }
                    }
                },
                hotel_name: {
                    validators: {
                        stringLength: {
                            min: 1,
                            message: '此欄位不得空白'
                        },
                        notEmpty: {
                            message: '此欄位不得空白'
                        }
                    }
                },
                hotel_address: {
                    validators: {
                        stringLength: {
                            min: 1,
                            message: ' '
                        },
                        notEmpty: {
                            message: '此欄位不得空白'
                        },
                        regexp: {
                            regexp: /^[\u4E00-\u9FFF0-9\u3105-\u3129\-]+$/,
                            message: '地址格式不正確，僅能包含中文、數字和（-）符號'
                        }
                    }
                },

                hotel_lic_id: {
                    validators: {
                        notEmpty: {
                            message: '此欄位不得空白'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9 -]+$/,
                            message: '請確認輸入證號'
                        },
                        stringLength: {
                            min: 3,
                            message: "長度不符"
                        }
                    }
                },
            }
        });


        $(".change_password").on("click", function () {
            Swal.fire({
                title: "變更密碼",
                showCancelButton: true,
                confirmButtonText: '確定',
                cancelButtonText: '取消',
                html: `
                <div style="position: relative;"> 
                    <label style="width: 70px">新密碼</label>    
                         <input id ="new_password" name="new_password"  type="password" maxlength="20" style="width: 200px">
                         <i class="toggle-password-icon fas fa-eye" style="position: absolute; right: 50px; cursor:pointer"></i>
                            
                </div>
                <br>
                <div>
                    <label style="width: 70px">確認密碼</label>    
                         <input  id ="re_password" name="re_password"  type="password" maxlength="20" style="width: 200px">           
                </div>`

            }).then((result)=>{
                if(result.isConfirmed){
                	var newPassword = $("#new_password").val();
                	var passwordRegexp = /^[a-zA-Z0-9]{8,20}$/;
                	var rePassword = $("#re_password").val();
                	
                	if(passwordRegexp.test(newPassword)){
                		if(newPassword === rePassword){
                    		console.log("一樣");
                        	Swal.fire({
                        		iconHtml:`<img src= "./img/happy.gif" style="with 200px; height:200px;">`,
                            	title:"密碼變更成功",
                            	text:"請牢記您的新密碼"
                        	})
                        	 	var newOwnerName = $("#owner_name").val();
           						var newOwnerEmail = $("#owner_email").val();
           						var newOwnerPhone = $("#owner_phone").val();
           						var newOwnerBank = $("#owner_bank").val();
            					var newHotelName = $("#hotel_name").val();
            					var newHotelAddress = $("#hotel_address").val();
            					
                        		var data ={
                        			ownerName: newOwnerName,
                                    ownerEmail: newOwnerEmail,
                                    ownerPhone: newOwnerPhone,
                                    ownerBank: newOwnerBank,
                                    hotelName: newHotelName,
                                    hotelAddress: newHotelAddress,
                                    hotelLicId: $("#hotel_lic").text(),
                			ownerPassword:newPassword
                			};
                        	updateOwnerAccount(data);
                        	
                    	}else{
                    		Swal.fire({
                    			iconHtml:`<img src= "./img/cry.gif" style="with 150px; height:150px;">`,
                            	title:"密碼變更失敗",
                            	text:"兩次輸入的密碼不一致"
                        	})
                    	}
                		
                	}else{
                		Swal.fire({
                			icon:'error',
                        	title:"密碼不符格式",
                        	text:"密碼長度請介於8~20字符,僅能大小寫字母及數字"
                    	})
                	}
                	
                	
                	
                           	
                }
            });
            
        });
        
        
        
        
        
        
        $(document).on("click",".toggle-password-icon",function(){
            var passwordInput = $(this).closest("div").find("input");

            if(passwordInput.attr("type") === "password"){
                passwordInput.attr("type","text");
            }else{
                passwordInput.attr("type","password");
            }
        });

        

    });







</script>

</html>